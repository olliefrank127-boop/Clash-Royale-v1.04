<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini Royale — Browser Remake</title>
  <style>
    :root{--bg:#0b1220;--panel:#111827;--accent:#ffcc33;--muted:#9aa4b2}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#061021 0%,#081426 100%);display:flex;align-items:center;justify-content:center;color:white}
    .app{width:980px;max-width:98vw;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(0,0,0,0.6)}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--panel);border:1px solid rgba(255,255,255,0.04);color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .stage{background:#0c1727;border-radius:8px;padding:12px;display:flex;gap:12px}
    canvas{background:linear-gradient(180deg,#0f1b2b,#07101a);border-radius:6px;display:block}
    .sidebar{width:260px;display:flex;flex-direction:column;gap:10px}
    .panel{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;min-height:48px}
    .elixirBar{height:18px;border-radius:8px;background:rgba(255,255,255,0.03);position:relative;overflow:hidden}
    .elixirFill{position:absolute;left:0;top:0;height:100%;background:linear-gradient(90deg,#ffd967,#ffcc33);}
    .cards{display:flex;gap:8px}
    .card{flex:1;background:rgba(255,255,255,0.02);border-radius:8px;padding:6px;text-align:center;cursor:pointer}
    .card.disabled{opacity:0.45}
    .center{display:flex;align-items:center;justify-content:center}
    .overlay{display:none;}
    .muted{color:var(--muted);font-size:13px}
    footer{margin-top:12px;font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Mini Royale — Browser Remake</h1>
      <div class="controls">
        <div class="muted">Two lanes · elixir · drag & place</div>
        <button id="resetBtn" class="secondary">Restart</button>
        <button id="shareBtn">How to get URL</button>
      </div>
    </header>

    <div class="stage">
      <div style="flex:1;position:relative">
        <canvas id="game" width="640" height="420"></canvas>
      </div>

      <div class="sidebar">
        <div class="panel">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <div class="muted">Elixir</div>
              <div id="elixirText">0 / 10</div>
            </div>
            <div style="width:160px">
              <div class="elixirBar"><div id="elixirFill" class="elixirFill" style="width:0%"></div></div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="muted" style="margin-bottom:6px">Cards</div>
          <div class="cards">
            <div id="card1" class="card"><div>Knight<br><small class="muted">Cost 4</small></div></div>
            <div id="card2" class="card"><div>Archer<br><small class="muted">Cost 3</small></div></div>
            <div id="card3" class="card"><div>Giant<br><small class="muted">Cost 6</small></div></div>
          </div>
        </div>

        <div class="panel center" id="statusPanel">Status: <span id="statusText">Playing</span></div>
        <div class="panel muted">Drag a card and drop it on the battlefield to deploy troops to that lane.</div>
      </div>
    </div>

    <footer>Tip: deploy to GitHub Pages for a public URL.</footer>
  </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const elixirText = document.getElementById('elixirText');
const elixirFill = document.getElementById('elixirFill');
const statusText = document.getElementById('statusText');
const resetBtn = document.getElementById('resetBtn');
const shareBtn = document.getElementById('shareBtn');
const cardEls = [document.getElementById('card1'), document.getElementById('card2'), document.getElementById('card3')];

let game = null;

function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

class Entity{
  constructor(x,y,r,opts={}){
    this.x=x;this.y=y;this.r=r;this.hp=opts.hp||10;this.maxHp=this.hp;this.owner=opts.owner||'player';
    this.atk=opts.atk||4;this.speed=opts.speed||1;this.range=opts.range||0;this.type=opts.type||'troop';
    this.target=null;this.alive=true;this.lane=opts.lane||'left';this.unitType=opts.unitType||'';
  }
  takeDamage(d){this.hp-=d;if(this.hp<=0){this.hp=0;this.alive=false;}}
}

class Game{
  constructor(){this.w=canvas.width; this.h=canvas.height; this.lanes={left:this.h*0.28,right:this.h*0.72}; this.reset();}
  reset(){
    this.time=0;this.state='playing';
    this.elixir=5;this.elixirMax=10;this.elixirRegen=1.5;this._regenTimer=0;
    this.entities=[];
    this.towers={playerLeft:{x:80,y:this.lanes.left,hp:100,max:100},playerKing:{x:80,y:this.h/2,hp:200,max:200},playerRight:{x:80,y:this.lanes.right,hp:100,max:100},enemyLeft:{x:this.w-80,y:this.lanes.left,hp:100,max:100},enemyKing:{x:this.w-80,y:this.h/2,hp:200,max:200},enemyRight:{x:this.w-80,y:this.lanes.right,hp:100,max:100}};
    this.spawnCooldowns={card1:0,card2:0,card3:0};
    this.aiTimer=0; this.status='Playing';
  }
  spawnTroop(cardIndex,lane,owner='player',x=null,y=null){
    const costs=[4,3,6];
    const defs=[{hp:120,atk:18,speed:1.6,r:12,type:'knight'},{hp:60,atk:12,speed:1.2,r:9,range:120,type:'archer'},{hp:200,atk:28,speed:0.9,r:16,type:'giant'}];
    if(owner==='player'&&this.elixir<costs[cardIndex]) return false;
    if(this.spawnCooldowns['card'+(cardIndex+1)]>0) return false;
    const def=defs[cardIndex];
    const px=x!==null? x : (owner==='player'?120:this.w-120);
    const py=y!==null? y : this.lanes[lane];
    const ent=new Entity(px,py,def.r,{hp:def.hp,atk:def.atk,speed:def.speed,range:def.range||0,owner:owner});
    ent.unitType=def.type; ent.lane=lane; this.entities.push(ent);
    if(owner==='player'){this.elixir-=costs[cardIndex]; this.spawnCooldowns['card'+(cardIndex+1)]=0.5;}
    return true;
  }
  update(dt){
    this.time+=dt; this._regenTimer+=dt;
    if(this._regenTimer>=this.elixirRegen){this._regenTimer=0;this.elixir=clamp(this.elixir+1,0,this.elixirMax);}
    for(let k in this.spawnCooldowns) this.spawnCooldowns[k]=Math.max(0,this.spawnCooldowns[k]-dt);
    this.aiTimer+=dt; if(this.aiTimer>1.2){this.aiTimer=0; const lane=Math.random()<0.5?'left':'right'; const closest=this.towers['player'+(lane==='left'?'Left':'Right')]; this.spawnTroop(Math.random()<0.6?0:1,lane,'enemy',this.w-120,closest.y);}
    for(let e of this.entities){if(!e.alive) continue; let enemy=null; let dist=1e9; for(let o of this.entities){if(o.alive && o.owner!==e.owner){const d=Math.hypot(o.x-e.x,o.y-e.y);if(d<dist){enemy=o;dist=d;}}} if(enemy && dist<=Math.max(e.range,e.r+enemy.r+2)){if(!e._atkTimer)e._atkTimer=0;e._atkTimer-=dt;if(e._atkTimer<=0){enemy.takeDamage(e.atk);e._atkTimer=0.7;}} else{const targetX=e.owner==='player'?this.w-150:150; const dir=Math.sign(targetX-e.x); e.x+=dir*e.speed;} const towerKeys=e.owner==='player'?['enemyLeft','enemyKing','enemyRight']:['playerLeft','playerKing','playerRight']; for(let tk of towerKeys){const t=this.towers[tk]; const d=Math.hypot(e.x-t.x,e.y-t.y); if(d<=e.r+22){if(!e._atkTowerTimer)e._atkTowerTimer=0;e._atkTowerTimer-=dt;if(e._atkTowerTimer<=0){t.hp-=e.atk;e._atkTowerTimer=0.8;if(t.hp<0)t.hp=0;}}} } for(let i=this.entities.length-1;i>=0;i--){if(!this.entities[i].alive)this.entities.splice(i,1);} if(this.towers.enemyKing.hp<=0){this.state='win';this.status='You Win!';} if(this.towers.playerKing.hp<=0){this.state='lose';this.status='You Lose';} }
  draw(){ctx.clearRect(0,0,this.w,this.h); ctx.fillStyle='#0b2b3a'; ctx.fillRect(0,this.h*0.45,this.w,this.h*0.1); ctx.strokeStyle='rgba(255,255,255,0.03)'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(0,this.lanes.left); ctx.lineTo(this.w,this.lanes.left); ctx.stroke(); ctx.beginPath(); ctx.moveTo(0,this.lanes.right); ctx.lineTo(this.w,this.lanes.right); ctx.stroke(); for(let k in this.towers){const t=this.towers[k]; const isEnemy=k.startsWith('enemy'); ctx.fillStyle=isEnemy?'#5a2b2b':'#234a2b'; ctx.fillRect(t.x-22,t.y-28,44,44); ctx.fillStyle='rgba(0,0,0,0.45)'; ctx.fillRect(t.x-28,t.y-36,56,6); ctx.fillStyle=isEnemy?'#ffb86b':'#8be78b'; ctx.fillRect(t.x-26,t.y-35,clamp(t.hp/t.max,0,1)*52,4); ctx.fillStyle='rgba(255,255,255,0.7)'; ctx.font='11px Arial'; ctx.textAlign='center'; ctx.fillText(k,t.x,t.y+38);} for(let e of this.entities){ctx.beginPath();ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.fillStyle=e.owner==='player'?'#44b3ff':'#ff7b7b';ctx.fill();ctx.fillStyle='rgba(0,0,0,0.2)';ctx.fillRect(e.x-2,e.y-3,4,3);ctx.fillStyle='#39d0ff';ctx.fillRect(e.x-e.r+1,e.y-e.r-7,(e.hp/e.maxHp)*(e.r*2-2),3);} ctx.fillStyle='rgba(255,255,255,0.06)'; ctx.fillRect(0,0,this.w,36); ctx.fillStyle='white'; ctx.font='14px Arial'; ctx.textAlign='left'; ctx.fillText('Mini Royale',10,22); ctx.textAlign='right'; ctx.fillText(this.status,this.w-10,22); }

function initGame(){game=new Game(); updateUI();} initGame();
let last=performance.now();
function loop(t){const dt=(t-last)/1000;last=t;if(game){game.update(dt);game.draw();updateUI();} requestAnimationFrame(loop);} requestAnimationFrame(loop);
function updateUI(){elixirText.textContent=Math.floor(game.elixir)+' / '+game.elixirMax;elixirFill.style.width=Math.round((game.elixir/game.elixirMax)*100)+'%';statusText.textContent=game.status;const costs=[4,3,6]; cardEls.forEach((el,i)=>{if(game.elixir>=costs[i]&&game.spawnCooldowns['card'+(i+1)]<=0&&game.state==='playing')el.classList.remove('disabled');else el.classList.add('disabled');});}

let draggingCard=null; let dragIdx=-1; cardEls.forEach((el,i)=>{el.addEventListener('mousedown',(e)=>{if(game.state==='playing'){draggingCard=el; dragIdx=i;}});});
document.addEventListener('mouseup',(e)=>{if(draggingCard){const rect=canvas.getBoundingClientRect();const x=e.clientX-rect.left;const y=e.clientY-rect.top; const lane=y<canvas.height/2?'left':'right'; game.spawnTroop(dragIdx,lane,'player',x,y); draggingCard=null; dragIdx=-1;}});
resetBtn.addEventListener('click',()=>{game.reset();});
shareBtn.addEventListener('click',()=>{alert('To get a public URL: Create GitHub repo, add this HTML as index.html, enable GitHub Pages in settings.');});
</script>
</body>
</html>
